# üéØ DEPLOYMENT SUMMARY

## What Has Been Created

Your Numbas LTI Provider deployment package now includes:

### üìù Documentation
1. **README_ENHANCED.md** - Main guide with overview
2. **QUICK_START.md** - Fast reference for common tasks
3. **DEPLOYMENT_GUIDE.md** - Comprehensive step-by-step guide
4. **DEPLOYMENT_SUMMARY.md** - This file

### üõ†Ô∏è Automation Scripts
1. **setup.sh** - Fully automated installation wizard
2. **diagnose.sh** - Health check and troubleshooting tool
3. **backup.sh** - Automated backup script with retention

### ‚öôÔ∏è Configuration Files
1. **settings.env** - Pre-filled configuration with sensible defaults
2. **docker-compose.yml** - Already configured (no changes needed)

## üöÄ How to Deploy

### Option 1: Fully Automated (Easiest)

```bash
# On your VPS
cd /opt
git clone https://github.com/numbas/numbas-lti-provider-docker.git
cd numbas-lti-provider-docker
sudo bash setup.sh
```

The script will prompt you for:
- Your domain name
- Admin credentials
- Support email
- SSL certificate type (Let's Encrypt or self-signed)

Everything else is automated!

### Option 2: Semi-Automated

```bash
# 1. Clone repository
git clone https://github.com/numbas/numbas-lti-provider-docker.git
cd numbas-lti-provider-docker

# 2. Edit configuration
nano settings.env
# Update: SERVERNAME, SUPERUSER_USER, SUPERUSER_PASSWORD, etc.

# 3. Get SSL certificate manually
certbot certonly --standalone -d your-domain.com
cp /etc/letsencrypt/live/your-domain.com/fullchain.pem files/ssl/numbas-lti.pem
cp /etc/letsencrypt/live/your-domain.com/privkey.pem files/ssl/numbas-lti.key

# 4. Build and install
docker build . -t numbas/numbas-lti-provider
docker compose run --rm numbas-setup python ./get_secret_key  # Copy output to settings.env
docker compose run --rm numbas-setup python ./install

# 5. Start services
docker compose up -d --scale daphne=4 --scale huey=1
```

### Option 3: Manual (Full Control)

Follow the complete guide in [DEPLOYMENT_GUIDE.md](DEPLOYMENT_GUIDE.md)

## üìã Configuration Checklist

Before deployment, verify these settings in `settings.env`:

```bash
‚úì SERVERNAME - Your actual domain name
‚úì INSTANCE_NAME - Display name for your instance
‚úì SUPERUSER_USER - Admin username
‚úì SUPERUSER_PASSWORD - Strong password (16+ characters)
‚úì DEFAULT_FROM_EMAIL - Valid email address
‚úì SUPPORT_URL - Support contact method
‚úì POSTGRES_PASSWORD - Database password (auto-generated by script)
‚úì SECRET_KEY - Django secret (auto-generated by script)
```

## üîç Health Check

After deployment, run the diagnostic tool:

```bash
sudo bash diagnose.sh
```

This checks:
- System requirements (RAM, CPU, disk)
- Docker installation
- Configuration files
- SSL certificates
- Container status
- Network connectivity
- Recent errors

## üîí SSL Certificate Options

### Option A: Let's Encrypt (Recommended)
- Free
- Auto-renewable
- Trusted by all browsers
- Requires domain pointing to your server

```bash
# Automated by setup.sh or manual:
certbot certonly --standalone -d your-domain.com
```

### Option B: Self-Signed (Testing Only)
- Immediate
- No domain required
- Browser warnings
- Good for testing

```bash
# Automated by setup.sh or manual:
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout files/ssl/numbas-lti.key \
  -out files/ssl/numbas-lti.pem
```

## üìä Performance Guidelines

| Traffic Level | Concurrent Users | Configuration |
|--------------|-----------------|---------------|
| Low | < 50 | `--scale daphne=2 --scale huey=1` |
| Medium | 50-200 | `--scale daphne=4 --scale huey=1` |
| High | 200-500 | `--scale daphne=8 --scale huey=2` |
| Very High | 500+ | `--scale daphne=12 --scale huey=3` |

Adjust based on your VPS resources.

## üîÑ Common Operations

### View Logs
```bash
docker compose logs -f                # All services
docker compose logs -f nginx          # Specific service
docker compose logs --tail=100 nginx  # Last 100 lines
```

### Restart Services
```bash
docker compose restart                # All services
docker compose restart nginx          # Specific service
```

### Stop/Start
```bash
docker compose down                   # Stop all
docker compose up -d --scale daphne=4 --scale huey=1  # Start all
```

### Backup
```bash
sudo bash backup.sh
```

### Check Status
```bash
docker compose ps                     # Container status
docker stats                          # Resource usage
sudo bash diagnose.sh                 # Full health check
```

## üêõ Troubleshooting Quick Reference

| Problem | Quick Fix |
|---------|----------|
| Can't access site | `sudo bash diagnose.sh` then check DNS and firewall |
| 502 Bad Gateway | `docker compose restart daphne` |
| SSL errors | Check `files/ssl/` permissions: 644 for .pem, 600 for .key |
| Database errors | `docker compose logs postgres` then check password in settings.env |
| Out of memory | Reduce daphne scale: `--scale daphne=2` |

## üì¶ Backup Strategy

### Manual Backup
```bash
sudo bash backup.sh
```

### Automated Daily Backups
```bash
# Add to crontab
sudo crontab -e

# Add this line for daily backups at 2 AM:
0 2 * * * /opt/numbas-lti-provider-docker/backup.sh >> /var/log/numbas-backup.log 2>&1
```

### What Gets Backed Up
- PostgreSQL database (compressed)
- Docker volumes (media files, static files)
- Configuration files (settings.env, SSL certs)
- Automatic 30-day retention

## üîê Security Checklist

After deployment:

- [ ] Changed default admin password
- [ ] Using strong passwords (16+ chars, mixed case, numbers, symbols)
- [ ] SSL certificate installed and valid
- [ ] Firewall configured (only ports 22, 80, 443)
- [ ] SSH key authentication enabled
- [ ] Root login disabled
- [ ] Automatic security updates enabled
- [ ] Regular backups scheduled
- [ ] Backup tested (restore once to verify)
- [ ] `settings.env` not committed to git
- [ ] Monitoring/alerting configured

## üìà Monitoring

### Built-in Checks
```bash
# Container health
docker compose ps

# Resource usage
docker stats

# Recent errors
docker compose logs --tail=100 | grep -i error

# Full diagnostic
sudo bash diagnose.sh
```

### Log Levels
In `settings.env`, adjust logging:
- `LOGLEVEL=DEBUG` - Verbose (development)
- `LOGLEVEL=INFO` - Normal
- `LOGLEVEL=WARNING` - Production (default)
- `LOGLEVEL=ERROR` - Only errors

## üÜò Getting Help

### Self-Service
1. Run `sudo bash diagnose.sh`
2. Check logs: `docker compose logs -f`
3. Review [DEPLOYMENT_GUIDE.md](DEPLOYMENT_GUIDE.md)
4. Check [QUICK_START.md](QUICK_START.md)

### Community Support
- Documentation: https://docs.numbas.org.uk/lti
- Discussions: https://github.com/numbas/Numbas/discussions
- Issues: https://github.com/numbas/numbas-lti-provider/issues

## ‚ö†Ô∏è Important Notes

1. **Domain Requirements**: Your domain MUST point to your VPS IP before requesting Let's Encrypt certificates
2. **Firewall**: Ensure ports 80 and 443 are open before running setup
3. **Resources**: Minimum 2GB RAM, 2 CPU cores, 20GB disk
4. **Backups**: Test restore process at least once
5. **Updates**: Keep Docker and system packages updated
6. **Passwords**: Never commit `settings.env` to version control

## üéì Next Steps After Deployment

1. **Access your instance**: `https://your-domain.com`
2. **Log in** with admin credentials
3. **Change password** immediately (user dropdown ‚Üí Settings)
4. **Test basic functionality**:
   - Create a test resource
   - Try accessing as a student
   - Test LTI integration
5. **Set up backups**: 
   - Test `sudo bash backup.sh`
   - Add to cron for automation
6. **Configure monitoring**:
   - Set up email alerts
   - Configure log aggregation (optional)
7. **Document your setup**:
   - Save credentials securely
   - Note your configuration choices
   - Keep backup of `settings.env` (encrypted!)

## üìä Estimated Timeline

| Task | Time |
|------|------|
| VPS setup | 10 min |
| Clone repository | 2 min |
| Run setup.sh | 10-15 min |
| Configuration & testing | 10 min |
| **Total** | **~30-40 min** |

## ‚úÖ Success Criteria

Your deployment is successful when:

1. `sudo bash diagnose.sh` shows all green checkmarks
2. You can access `https://your-domain.com`
3. You can log in as admin
4. No errors in `docker compose logs`
5. All containers show "Up" in `docker compose ps`

## üéâ You're Done!

Your Numbas LTI Provider is now:
- ‚úÖ Installed and configured
- ‚úÖ Running with proper SSL
- ‚úÖ Backed up automatically (if scheduled)
- ‚úÖ Monitored with diagnostic tools
- ‚úÖ Ready for production use

Enjoy your new Numbas LTI Provider installation!

---

**Questions?** Run `sudo bash diagnose.sh` first, then check the guides!
